<html>
    <head>
        <style type="text/css">
            #editor {
                position: relative;
                width: 100%;
                height: 80%;
            }
        </style>
    </head>
    <body>
        <div>
            Define variables called <code>initial</code>, <code>step</code>,
            and <code>draw</code> describing your simulation's initial state,
            step function, and appearance.  Remember to import the
            <code>Graphics.Gloss</code> module.
            <a href="http://hackage.haskell.org/packages/archive/gloss/latest/doc/html/Graphics-Gloss-Data-Picture.html">
            Check here for things you can do</a>.  Have fun!
            <hr>
        </div>
        <form id="form" action="simulateInBrowser" method="post" target="display">
        <div id="editor">Loading...</div>
        <script type="text/javascript" src="ace/ace.js" charset="utf-8"></script>
        <script type="text/javascript" src="mode-haskell.js" charset="utf-8"></script>
        <script type="text/javascript">
            var editor;

            window.onload = function() {
                editor = ace.edit("editor");

                var all = document.cookie;
                var list = all.split("; ");
                var found = false;
                for (var i = 0; i < list.length; i++)
                {
                    var cookie = list[i];
                    var p = cookie.indexOf("=");
                    var name = cookie.substring(0,p);
                    if (name == "simulateSource")
                    {
                        var value = decodeURIComponent(cookie.substring(p+1));
                        editor.getSession().setValue(value);
                        found = true;
                        break;
                    }
                }

                if (!found)
                {
                    var value = "import Graphics.Gloss\n\n"
                        + "data BallState = BallAt Float Float\n"
                        + "initial = BallAt 100 0\n"
                        + "step _ t (BallAt x v) = BallAt (x+v*t) (0.99*v-x*t)\n"
                        + "draw     (BallAt x v) = translate x x (circle 20)";
                    editor.getSession().setValue(value);
                }

                var HaskellMode = require('ace/mode/haskell').Mode;
                editor.getSession().setMode(new HaskellMode());
                editor.focus();
            };

            function run()
            {
                var s = editor.getSession().getValue();
                window.open('about:blank', 'display', 'width=620,height=620');
                document.cookie = "simulateSource=" + encodeURIComponent(s)
                    + "; max-age = " + (1000 * 365 * 24 * 60 * 60);
                document.getElementById("codefield").value = s
                document.getElementById("form").submit();
                editor.focus();
            }
        </script>

        <div style="text-align: center">
          <input id="codefield" type="hidden" name="source" value=""/>
          <input type="button" value="Run" onclick="run()"/>
        </div>
        </form>
    </body>
</html>
